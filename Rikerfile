#!/bin/sh

BLAKE3=deps/BLAKE3/c

OPT="-O3"
CFLAGS="$OPT -Isrc/rkr -Ideps/CLI11/include -I$BLAKE3 -Wall -Wfatal-errors"
CXXFLAGS="$CFLAGS --std=c++17"

mkdir -p .blake3obj
clang $CFLAGS -o .blake3obj/blake3.o -c $BLAKE3/blake3.c
clang $CFLAGS -o .blake3obj/blake3_dispatch.o -c $BLAKE3/blake3_dispatch.c
clang $CFLAGS -o .blake3obj/blake3_portable.o -c $BLAKE3/blake3_portable.c
clang $CFLAGS -msse2 -o .blake3obj/blake3_sse2.o -c $BLAKE3/blake3_sse2.c
clang $CFLAGS -msse4.1 -o .blake3obj/blake3_sse41.o -c $BLAKE3/blake3_sse41.c
clang $CFLAGS -mavx2 -o .blake3obj/blake3_avx2.o -c $BLAKE3/blake3_avx2.c
clang $CFLAGS -mavx512f -mavx512vl -o .blake3obj/blake3_avx512.o -c $BLAKE3/blake3_avx512.c

clang++ $CXXFLAGS -o rkr src/rkr/*/*.cc .blake3obj/*.o -lstdc++fs -lfmt -lpthread
