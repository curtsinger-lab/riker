#!/bin/sh

DIR1=".obj/artifacts/"
SRC1="../../src/artifacts/DirArtifact.cc ../../src/artifacts/Artifact.cc ../../src/artifacts/SymlinkArtifact.cc ../../src/artifacts/PipeArtifact.cc ../../src/artifacts/SpecialArtifact.cc ../../src/artifacts/FileArtifact.cc"
DIR2=".obj/ui/"
SRC2="../../src/ui/rkr-graph.cc ../../src/ui/rkr-audit.cc ../../src/ui/rkr-build.cc ../../src/ui/rkr-stats.cc ../../src/ui/rkr-generate.cc ../../src/ui/rkr-check.cc ../../src/ui/rkr.cc ../../src/ui/rkr-trace.cc"
DIR3=".obj/versions/"
SRC3="../../src/versions/PipeVersion.cc ../../src/versions/SymlinkVersion.cc ../../src/versions/MetadataVersion.cc ../../src/versions/DirVersion.cc ../../src/versions/FileVersion.cc"
DIR4=".obj/util/"
SRC4="../../src/util/terminate.cc ../../src/util/Graph.cc ../../src/util/stats.cc"
DIR5=".obj/runtime/"
SRC5="../../src/runtime/Ref.cc ../../src/runtime/Build.cc ../../src/runtime/policy.cc ../../src/runtime/Command.cc ../../src/runtime/env.cc"
DIR6=".obj/tracing/"
SRC6="../../src/tracing/SyscallTable.cc ../../src/tracing/Process.cc ../../src/tracing/Thread.cc ../../src/tracing/Tracer.cc"
DIR7=".obj/data/"
SRC7="../../src/data/OutputTrace.cc ../../src/data/DefaultTrace.cc ../../src/data/Record.cc ../../src/data/IRBuffer.cc ../../src/data/InputTrace.cc"
DIR8=".obj/blake3/"
SRC8="../../deps/BLAKE3/c/blake3.c ../../deps/BLAKE3/c/blake3_dispatch.c ../../deps/BLAKE3/c/blake3_portable.c"

cd .obj/artifacts/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC1
cd -
cd .obj/ui/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC2
cd -
cd .obj/versions/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC3
cd -
cd .obj/util/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC4
cd -
cd .obj/runtime/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC5
cd -
cd .obj/tracing/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC6
cd -
cd .obj/data/
clang++ -MMD -MP -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c --std=c++17 -I../../deps/cereal/include -I../../deps/CLI11/include -I../../ -c $SRC7
cd -
cd .obj/blake3/
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -I../../src -I../../deps/BLAKE3/c -I../../ -c $SRC8
cd -
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -Isrc -Ideps/BLAKE3/c -msse2 -o .obj/blake3/blake3_sse2.o -c deps/BLAKE3/c/blake3_sse2.c
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -Isrc -Ideps/BLAKE3/c -msse4.1 -o .obj/blake3/blake3_sse41.o -c deps/BLAKE3/c/blake3_sse41.c
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -Isrc -Ideps/BLAKE3/c -o rkr-launch launch/launch.c
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -Isrc -Ideps/BLAKE3/c -mavx2 -o .obj/blake3/blake3_avx2.o -c deps/BLAKE3/c/blake3_avx2.c
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -Isrc -Ideps/BLAKE3/c -mavx512f -mavx512vl -o .obj/blake3/blake3_avx512.o -c deps/BLAKE3/c/blake3_avx512.c
clang -O3 -g -fstandalone-debug -Wall -Wfatal-errors -Isrc -Ideps/BLAKE3/c -fPIC -shared -Isrc/ -o rkr-inject.so inject/inject.c -ldl
clang++ .obj/artifacts/SpecialArtifact.o .obj/artifacts/DirArtifact.o .obj/artifacts/Artifact.o .obj/artifacts/SymlinkArtifact.o .obj/artifacts/FileArtifact.o .obj/artifacts/PipeArtifact.o .obj/ui/rkr-graph.o .obj/ui/rkr-audit.o .obj/ui/rkr-build.o .obj/ui/rkr-stats.o .obj/ui/rkr-generate.o .obj/ui/rkr-check.o .obj/ui/rkr.o .obj/ui/rkr-trace.o .obj/versions/PipeVersion.o .obj/versions/SymlinkVersion.o .obj/versions/MetadataVersion.o .obj/versions/DirVersion.o .obj/versions/FileVersion.o .obj/util/terminate.o .obj/util/Graph.o .obj/util/stats.o .obj/runtime/Ref.o .obj/runtime/Build.o .obj/runtime/policy.o .obj/runtime/Command.o .obj/runtime/env.o .obj/tracing/SyscallTable.o .obj/tracing/Process.o .obj/tracing/Thread.o .obj/tracing/Tracer.o .obj/data/OutputTrace.o .obj/data/DefaultTrace.o .obj/data/Record.o .obj/data/IRBuffer.o .obj/data/InputTrace.o .obj/blake3/blake3.o .obj/blake3/blake3_dispatch.o .obj/blake3/blake3_portable.o .obj/blake3/blake3_sse2.o .obj/blake3/blake3_sse41.o .obj/blake3/blake3_avx2.o .obj/blake3/blake3_avx512.o -o rkr -O3 -g -fstandalone-debug -lstdc++fs -lfmt
